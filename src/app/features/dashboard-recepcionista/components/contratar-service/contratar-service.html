<div class="container mx-auto p-6">
  <h1 class="text-2xl font-bold mb-6">Contratar Servicios para Clientes</h1>

  <!-- Formulario de búsqueda de habitación -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Buscar Cliente por Habitación</h2>
    <form [formGroup]="busquedaForm" (ngSubmit)="buscarHabitacion()" class="flex gap-4">
      <div class="flex-1">
        <label for="numeroHabitacion" class="block text-sm font-medium text-gray-700 mb-1">
          Número de Habitación
        </label>
        <input
          type="text"
          id="numeroHabitacion"
          formControlName="numeroHabitacion"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Ingrese el número de habitación"
        />
        <div
          *ngIf="
            busquedaForm.get('numeroHabitacion')?.invalid &&
            busquedaForm.get('numeroHabitacion')?.touched
          "
          class="text-red-500 text-sm mt-1"
        >
          Número de habitación requerido (solo números)
        </div>
      </div>
      <div class="flex items-end">
        <button
          type="submit"
          [disabled]="buscandoHabitacion() || busquedaForm.invalid"
          class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400"
        >
          {{ buscandoHabitacion() ? 'Buscando...' : 'Buscar' }}
        </button>
      </div>
    </form>

    <!-- Error en búsqueda -->
    <div
      *ngIf="errorBusqueda()"
      class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"
    >
      {{ errorBusqueda() }}
    </div>

    <!-- Información del cliente encontrado -->
    <div
      *ngIf="habitacionEncontrada()"
      class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg"
    >
      <h3 class="font-semibold text-lg text-green-800">Cliente Encontrado</h3>
      <div class="mt-2 grid grid-cols-2 gap-2">
        <div><span class="font-medium">Nombre:</span> {{ clienteActual?.nombreCompleto }}</div>
        <div><span class="font-medium">Habitación:</span> {{ informacionHabitacion.numero }}</div>
        <div><span class="font-medium">Tipo:</span> {{ informacionHabitacion.tipo }}</div>
        <div><span class="font-medium">Email:</span> {{ clienteActual?.email }}</div>
        <div><span class="font-medium">Teléfono:</span> {{ clienteActual?.telefono || 'N/A' }}</div>
        <div><span class="font-medium">Documento:</span> {{ clienteActual?.documento }}</div>
        <div class="col-span-2">
          <span class="font-medium">Reserva:</span>
          {{ habitacionEncontrada()?.reservaActual?.fechaInicio | date : 'dd/MM/yyyy' }} -
          {{ habitacionEncontrada()?.reservaActual?.fechaFin | date : 'dd/MM/yyyy' }}
        </div>
      </div>
    </div>
  </div>

  <!-- Formulario de contratación de servicio -->
  <div *ngIf="habitacionEncontrada()" class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-semibold mb-4">Contratar Servicio</h2>

    <form [formGroup]="contratoForm" (ngSubmit)="contratarServicio()" class="space-y-4">
      <!-- Selección de servicio -->
      <div>
        <label for="servicioId" class="block text-sm font-medium text-gray-700 mb-1">
          Servicio *
        </label>
        <select
          id="servicioId"
          formControlName="servicioId"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="">Seleccione un servicio</option>
          <option *ngFor="let servicio of servicios()" [value]="servicio.id">
            {{ servicio.nombre }} - ${{ servicio.precioPorPersona.toLocaleString('es-CO') }}
          </option>
        </select>
        <div
          *ngIf="contratoForm.get('servicioId')?.invalid && contratoForm.get('servicioId')?.touched"
          class="text-red-500 text-sm mt-1"
        >
          Servicio requerido
        </div>
      </div>

      <!-- Cantidad de personas -->
      <div>
        <label for="cantidadPersonas" class="block text-sm font-medium text-gray-700 mb-1">
          Cantidad de Personas *
        </label>
        <input
          type="number"
          id="cantidadPersonas"
          formControlName="cantidadPersonas"
          min="1"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- Fecha -->
      <div>
        <label for="fecha" class="block text-sm font-medium text-gray-700 mb-1">
          Fecha del Servicio *
        </label>
        <input
          type="date"
          id="fecha"
          formControlName="fecha"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <div
          *ngIf="contratoForm.get('fecha')?.invalid && contratoForm.get('fecha')?.touched"
          class="text-red-500 text-sm mt-1"
        >
          Fecha requerida
        </div>
      </div>

      <!-- Observaciones -->
      <div>
        <label for="observaciones" class="block text-sm font-medium text-gray-700 mb-1">
          Observaciones
        </label>
        <textarea
          id="observaciones"
          formControlName="observaciones"
          rows="3"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Observaciones adicionales..."
        ></textarea>
      </div>

      <!-- Resumen y total -->
      <div *ngIf="getServicioSeleccionado()" class="p-4 bg-gray-50 rounded-lg">
        <h4 class="font-semibold mb-2">Resumen</h4>
        <div class="flex justify-between">
          <span>Servicio:</span>
          <span>{{ getServicioSeleccionado()!.nombre }}</span>
        </div>
        <div class="flex justify-between">
          <span>Precio por persona:</span>
          <span>${{ getServicioSeleccionado()!.precioPorPersona.toLocaleString('es-CO') }}</span>
        </div>
        <div class="flex justify-between">
          <span>Cantidad de personas:</span>
          <span>{{ contratoForm.value.cantidadPersonas }}</span>
        </div>
        <div class="flex justify-between font-bold text-lg mt-2 pt-2 border-t">
          <span>Total:</span>
          <span>${{ calcularTotal().toLocaleString('es-CO') }}</span>
        </div>
      </div>

      <!-- Botones -->
      <div class="flex gap-4 pt-4">
        <button
          type="submit"
          [disabled]="contratando() || contratoForm.invalid"
          class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400"
        >
          {{ contratando() ? 'Contratando...' : 'Contratar Servicio' }}
        </button>
        <button
          type="button"
          (click)="cancelar()"
          class="px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"
        >
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>
